server {
    listen 80;

    client_header_buffer_size 128k;
    large_client_header_buffers 4 128k;

    server_name m-asos.showmao.com ;

#    access_log /opt/nginx/logs/asos_access.log ;

#    error_log /opt/nginx/logs/asos_error.log ;


#    rewrite_log on;

        proxy_set_header Accept-Encoding "";


    location ~ /(http.*) {
    	set $originurl $1;

	#set $uab $ua;

	subs_filter '(["\'])(https?://)' '$1/$2' ir;

	#sub_filter '<title>' '<link rel="stylesheet" href="//1tcdn.1haitao.com/$uab/css/em-main.css?v=1479500136"><title>';	


	sub_filter '<title>' '<input type="hidden" id="origin-url" value="$originurl" scriptddrre="a"><title>' ;
	sub_filter '</title>' '</title><script type="text/javascript" id="requirejs" data-main="//1tcdn.1haitao.com/??common/js/yht_host.js,explugin/js/em-loader.js?v=2016022423" data-version="2016022423" src="//1tcdn.1haitao.com/explugin/js/require.js?v=2016022423"></script>';

        #add_header X-debug-message "$request_uri $path $http_user_agent $uab " always;
        proxy_pass http://unix:/var/run/nginx-gunzip.sock:$request_uri;
        #proxy_redirect ~^/(.*)$ /$origin/$1;
       proxy_redirect ~^(.*)$ /$1;
   }

   location / {

	subs_filter '(["\'])(https?://)' '$1/$2' ir;
	sub_filter '<title>' '<input type="hidden" id="origin-url" value="http://m.asos.com$request_uri" scriptddrre="a"><title>' ;
	sub_filter '</title>' '</title><script type="text/javascript" id="requirejs" data-main="//1tcdn.1haitao.com/??common/js/yht_host.js,explugin/js/em-loader.js?v=2016022423" data-version="2016022423" src="//1tcdn.1haitao.com/explugin/js/require.js?v=2016022423"></script>';
	set $domain "http://m.asos.com";
	#if ( $http_user_agent ~* (android|ios) ) 
	#{
	#	set $domain "http://m.asos.com";	
	#}
	proxy_pass  http://unix:/var/run/nginx-gunzip.sock:/$domain$request_uri;
       proxy_redirect ~^([^/].*)$ /$1;

	}
}
